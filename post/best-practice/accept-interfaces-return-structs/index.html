<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Accept interfaces return structs &middot; Craig Brookes</title>
        <meta name="description" content="Outlines why you should write your packages to accept interfaces and return structs">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.17" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="http://idiomaticgo.com/css/normalize.css">
        <link rel="stylesheet" href="http://idiomaticgo.com/css/highlight.css">
        <link rel="stylesheet" href="http://idiomaticgo.com/css/style.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Idiomatic Go" href="http://idiomaticgo.com/">Idiomatic Go</a>
                            </h1>
                        
                        <a class="button-square" href="http://idiomaticgo.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/maleck13">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/maleck13">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        
                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Accept interfaces return structs</h1>
    
        <p class="post-description" itemprop="description">Outlines why you should write your packages to accept interfaces and return structs</p>
    
    <p class="post-date">
        <span>Published <time datetime="2016-11-02" itemprop="datePublished">Wed, Nov 2, 2016</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="http://schema.org/Person">
            <span itemprop="name">
                <a href="https://github.com/maleck13" itemprop="url" rel="author">Craig Brookes</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>I have heard mentioned several times this idea of accepting interfaces and returning structs.
Here I will try to outline why I think this is good practice.</p>

<p>When writing packages our goal is for them to be consumed by someone. Either by our own code, but also, hopefully, by others too.
We want to make this as simple and frictionless as possible and avoid causing frustration for the consumers of our packages.
Accepting interfaces and returning structs can be a powerful way to achieve this.
It allows the consumers of our packages to reduce the coupling between their code and yours. It also makes it
easier to write tests for their code that depend on your package. Lets look at some examples.</p>

<p>First lets look at what happens when we accept a type specific to our package in the exposed API and then return an interface we have defined:</p>

<pre><code class="language-go">
package rest

type Config struct {
	Host string
	Port int32
}

</code></pre>

<pre><code class="language-go">
package client

import &quot;github.com/someone/rest&quot;

type Client interface {
	DoSomething() error
	DoSomethingMore() error
	ThisIsDoingSomething() error
}

func New(c rest.Config) Client {
	/// init and return a client
}
</code></pre>

<p>You could argue that the config and the client should be in the same package and you would probably be right, but this is just a contrived example to illustrate the point.
Now someone consuming our code has to do some extra work when testing and also rely on not only the <code>client</code> package but also the <code>rest</code> package.</p>

<pre><code class="language-go">
package mywebsite

import(
    &quot;github.com/someone/client&quot;
    &quot;github.com/someone/rest&quot;
)

func SomeFunc(c client.Client) error {

	return c.DoSomething()
}

func main() {
	c := client.New(rest.Config{
		Host: &quot;ahost&quot;,
		Port: 3000,
	})
	SomeFunc(c)
}
</code></pre>

<p>So we mentioned how this pattern effect tests. How does this effect tests? Well because we returned an interface that we defined,
the consumer is now forced to implement every method on that interface rather than just the ones they care about:</p>

<pre><code class="language-go">//test my service with a mock client 

package mywebsite_test

import &quot;github.com/me/mywebsite&quot; 
type mockClient struct{}

//notice we have to implement all the methods rather than just the one we use.

func (mockClient) DoSomething() error {
	return nil
}
func (mockClient) DoSomethingMore() error {
	return nil
}
func (mockClient) ThisIsDoingSomething() error {
	return nil
}

func TestSomeFunc(t *testing.T) {
	if err := mywebsite.SomeFunc(mockClient{}); err != nil {
		t.Errorf(&quot;did not expect an error but got %s &quot;, err.Error())
	}
}

</code></pre>

<p>Now lets change our implementation to accept intefaces and return structs.</p>

<pre><code class="language-go">
package client

type ClientConfig interface {
	Host() string
	Port() int32
}

type Client struct {
	config ClientConfig
}

func (c *Client) DoSomething() error {
	//do some work ...
	return nil
}

//imagine more methods

/// New inits and returns a client
func New(c ClientConfig) *Client {
	return &amp;Client{
		config: c,
	}
}
</code></pre>

<p>So now our implementation has changed lets see the impact we have on the consumers of our code.</p>

<pre><code class="language-go">
package mywebsite

import(
    &quot;github.com/someone/client&quot; //Only one import now
)

type clientConfig struct{}

func (cc clientConfig) Host() string {
	return &quot;ahost&quot;
}

func (cc clientConfig) Port() int32 {
	return 3000
}

// Consumer can now define an interface that our struct fulfills but that only has one method.
type Client interface {
	DoSomething() error
}

func SomeFunc(c Client) error {

	return c.DoSomething()
}

func main() {
	c := client.New(&amp;clientConfig{})
	SomeFunc(c)
}
</code></pre>

<p>So now there is only one import from our package reducing our footprint on the consumer&rsquo;s code. But more importantly, because we returned a struct,
the consumer of the code can define their own interface with just the methods they care about. Lets look at our test code now.</p>

<pre><code class="language-go">//test my service with a mock client 

package mywebsite_test

import &quot;github.com/me/mywebsite&quot; 

type mockClient struct{}

//notice we have to implement ONLY the method we use now.

func (mockClient) DoSomething() error {
	return nil
}

func TestSomeFunc(t *testing.T) {
	if err := mywebsite.SomeFunc(mockClient{}); err != nil {
		t.Errorf(&quot;did not expect an error but got %s &quot;, err.Error())
	}
}

</code></pre>

<p>The boiler plate in the test is vastly reduced as only one method had to be mocked rather than three.
Hopefully I have shown the benefit of accepting interfaces and returning structs here and it will inspire you to
make use of this pattern in your own code.</p>

</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        <a class="icon-twitter" href="http://twitter.com/share?text=Accept%20interfaces%20return%20structs&url=http%3a%2f%2fidiomaticgo.com%2fpost%2fbest-practice%2faccept-interfaces-return-structs%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fidiomaticgo.com%2fpost%2fbest-practice%2faccept-interfaces-return-structs%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=http%3a%2f%2fidiomaticgo.com%2fpost%2fbest-practice%2faccept-interfaces-return-structs%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Idiomatic Go" href="http://idiomaticgo.com/">Idiomatic Go</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2016 / Powered by <a href="http://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="http://idiomaticgo.com/js/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
        <script src="http://idiomaticgo.com/js/jquery.fitvids.js"></script>
        <script src="http://idiomaticgo.com/js/scripts.js"></script>
    </body>
</html>

